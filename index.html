<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Raid Timer</title>
    <style>
      body {
        background-color: #333;
        color: #ccc;
        font-size: clamp(1rem, -0.875rem + 8.333333vw, 3.5rem);
        text-align: center;
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: monospace;
      }
      .sm {
        font-size: clamp(1rem, -0.875rem + 7.333333vw, 2.5rem);
      }
    </style>
  </head>
  <body>
    <script>
      // Function to check if it's raid time in the user's timezone
      function isRaidDay() {
        const now = new Date();
        const day = now.getUTCDay();
        const hours = now.getUTCHours();
        const minutes = now.getUTCMinutes();
        const raidTimeWednesday = 3 * 60 + 30; // 3:30am in minutes
        const raidTimeThursday = 4 * 60; // 4:00am in minutes

        // Calculate time until the next raid time
        const timeUntilRaidWednesday =
          (raidTimeWednesday - (hours * 60 + minutes) + 1440) % 1440; // Adding 1440 to handle negative values
        const timeUntilRaidThursday =
          (raidTimeThursday - (hours * 60 + minutes) + 1440) % 1440;

        // Check if the current time is within 30 minutes of the raid time
        if (
          (day === 3 && timeUntilRaidWednesday <= 30) ||
          (day === 4 && timeUntilRaidThursday <= 30)
        ) {
          return true;
        }

        return false;
      }

      // Function to update the display based on raid day
      function updateDisplay() {
        const raidDay = isRaidDay();

        if (raidDay) {
          document.body.innerHTML =
            "<p class='sm'> is it a raid day???</p><p id='status'>YES. It's raid day!!</p><p id='timer'></p>";

          // Calculate time until raid time
          const now = new Date();
          const raidTime = new Date(now);
          raidTime.setUTCHours(now.getUTCDay() === 3 ? 3 : 4, 30, 0, 0);
          let timeUntilRaid = raidTime - now;

          // Display countdown timer
          const timerElement = document.getElementById("timer");
          const countdownTimer = setInterval(function () {
            const minutes = Math.floor(timeUntilRaid / 60000);
            const seconds = Math.floor((timeUntilRaid % 60000) / 1000);

            if (timeUntilRaid <= 0) {
              clearInterval(countdownTimer);
              startRaidCountup();
            } else {
              timerElement.textContent = `Countdown: ${minutes}m ${seconds}s`;
              timeUntilRaid -= 1000;
            }
          }, 1000);
        } else {
          document.body.innerHTML =
            "<p class='sm'> is it a raid day???</p><p id='status'>No, it's not a raid day :(</p>";
        }
      }

      // Function to start the count up after raid time has started
      function startRaidCountup() {
        const timerElement = document.getElementById("timer");
        timerElement.textContent = "It's raid time!!!";

        // Calculate time until raid day ends
        const now = new Date();
        const raidEndTime = new Date(now);
        raidEndTime.setUTCHours(now.getUTCDay() === 3 ? 5 : 4, 30, 0, 0); // Raid day ends after 90 or 60 minutes

        const countupTimer = setInterval(function () {
          const minutes = Math.floor((now - raidEndTime) / 60000);
          const seconds = Math.floor(((now - raidEndTime) % 60000) / 1000);

          if (now - raidEndTime >= 0) {
            clearInterval(countupTimer);
            document.body.innerHTML =
              "<p id='status'>it IS a raid day, but raid is over :(</p>";
          } else {
            timerElement.textContent = `Countup: ${minutes}m ${seconds}s`;
            now.setSeconds(now.getSeconds() + 1);
          }
        }, 1000);
      }

      // Call the initial update
      updateDisplay();
    </script>
  </body>
</html>
